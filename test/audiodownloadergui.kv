# ---------- audiodownloadergui.kv  ----------

# Next import instructions avoid importing the classes in the
# *.py python file, import instruction which will be removed by
# Pycharm when optimizing the imports or applying some refactoring !

#: import ScrollEffect kivy.effects.scroll.ScrollEffect
#: import RecycleViewKivyBugFix gui.recycleviewkivybugfix.RecycleViewKivyBugFix

<AudioDownloaderGUI>: # sub-class of Screen
	name: "audioDownloaderScreen"
	requestInput: request_TextInput
	requestListRV: request_RecycleView_list
	outputScrollView: scrlv_out
	outputLabel: ro_output_Label
	toggleHistoButton: toggle_history_list_Button
	deleteBrowseButton: delete_browse_Button
	replaceButton: replace_Button
	downloadAllButton: download_all_Button
	moveUpButton: moveUp_Button
	moveDownButton: moveDown_Button
	boxLayoutContainingStatusBar: boxlayout_statusbar
	statusBarGridLayout: gridlayout_status_bar
	statusBarScrollView: scrlv_status_bar
	statusBarTextInput: status_bar
	clearResultOutputButton: clear_output_Button
	stopDownloadButton: stop_download_Button
	requestListRVSelBoxLayout: selectable_recyclebox_layout
	boxLayoutContainingRV: boxlayout_recycleview
	downloadButton: download_Button
	addDownloadButton: add_download_Button
	BoxLayout:
		orientation: "vertical"

		# adding main windows borders. Does not impact sub widgets !
		padding: 5
		spacing: 5

		canvas.before:
			Color:
				rgb: [0.22,0.22,0.22]
			Rectangle:
				pos: self.pos
				size: self.size

		BoxLayout:
			size_hint_y: None
			height: "28dp"
			canvas.before:
				Color:
					rgb: [0,0,0]
				Rectangle:
					pos: self.pos
					size: self.size

			GridLayout:
				cols: 4
				TextInput:
					id: request_TextInput
					background_color: 0,0,0,0
					foreground_color: 1,1,1,1
					multiline: False
					#ENTER triggers root.submitRequest()
					on_text_validate: root.submitRequest()
				Button:
					id: add_download_Button
					text: 'Add'
					size_hint_x: None
		#			width: 40 # Windows
		#			width: 80 # tablet
					width: 130 # smartphone
					on_press: root.addDownloadUrlToUrlList()
				Button:
					id: download_Button
					text: 'Download'
					size_hint_x: None
		#			width: 80 # Windows
		#			width: 180 # tablet
					width: 300 # smartphone
					on_press: root.downloadFromClipboard()
				Button:
					id: stop_download_Button
					text: 'Stop'
					size_hint_x: None
		#			width: 40 # Windows
		#			width: 80 # tablet
					width: 130 # smartphone
					on_press: root.stopDownload()

		BoxLayout:
			size_hint_y: None
			height: "28dp"
			ToggleButton:
				id: toggle_history_list_Button
				text: "Url's"
				size_hint_x: 15
				disabled:True
				on_press: root.toggleRequestList()
			Button:
				id: delete_browse_Button # depending on the list content, delete
				                         # the list item or open a browser on it
				text: "Delete"
				size_hint_x: 15
				disabled: True
				on_press: root.deleteOrBrowseItem()
			Button:
				id: replace_Button
				text: "Replace"
				size_hint_x: 15
				disabled: True
				on_press: root.replaceRequest()
			Button:
				id: moveUp_Button
				size_hint_x: 8
				disabled: True
				on_press: selectable_recyclebox_layout.moveItemUp()
				StackLayout:
					pos: self.parent.pos
					size: self.parent.size
					orientation: 'lr-tb'
					Image:
						source: 'arrow-up-32-disabled.png' if self.parent.disabled else 'arrow-up-32.png'
						size_hint_x: 1
						width: 74
			Button:
				id: moveDown_Button
				size_hint_x: 8
				disabled: True
				on_press: selectable_recyclebox_layout.moveItemDown()
				StackLayout:
					pos: self.parent.pos
					size: self.parent.size
					orientation: 'lr-tb'
					Image:
						source: 'arrow-down-32-disabled.png' if self.parent.disabled else 'arrow-down-32.png'
						size_hint_x: 1
						width: 74
			Button:
				id: download_all_Button
				text: "Down All"
				size_hint_x: 15
				disabled: True
				on_press: root.handleSelectedItems()
			Button:
				id: menu_Button
				text: "..."
				size_hint_x: 13
				on_release: root.openDropDownMenu(self)

		BoxLayout:
			id: boxlayout_recycleview
			size_hint_y: None
			height: "0dp"

			RecycleViewKivyBugFix:  # sub-class of RecycleView. Fixes a Kivy bug which
									# sometimes causes an app failure when the first
									# selected item in a displayed list is the last item
				id: request_RecycleView_list
				rootGUI: root
				scroll_y: 1 # 0 forces scrolling to list bottom after adding an entry,
				            # 1 forces scrolling to top
				effect_cls: "ScrollEffect" # prevents overscrolling
				viewclass: 'SelectableMultiFieldsItem'
				scroll_type: ['bars', 'content']
				scroll_wheel_distance: dp(114)
				bar_width: dp(10)

				AudioDownloadSelectableRecycleBoxLayout:    # subclass of SelectableRecycleBoxLayout
															# which derives from RecycleBoxLayout
					id: selectable_recyclebox_layout
					appGUI: root
					key_selection: 'selectable' # required so that 'selectable'
												# key/value can be added to
												# RecycleView data items
					default_size: None, dp(15)
					default_size_hint: 1, None
					size_hint_y: None
					height: self.minimum_height
					spacing: 0.5
					orientation: 'vertical'
					multiselect: False
					touch_multiselect: False

		ScrollView:
			id: scrlv_out
			canvas.before:
				Color:
					rgb: [0,0,0]
				Rectangle:
					pos: self.pos
					size: self.size
			effect_cls: "ScrollEffect" #prevents overscrolling
			#scroll_y: 0 # forces scrolling to bottom after adding text. Works only on TextInput, not on Label !!!
			do_scroll_x: False # limiting to vertical scrolling
			do_scroll_y: True

			Label:
				id: ro_output_Label
				size_hint_y: None
				height: self.texture_size[1]
				text_size: (self.width-20), None
				# max_lines: 1000 no effect !
				line_height: 0.9
				background_color: 0,0,0,0
				foreground_color: 1,1,1,1
				valign: "top"
				markup: True


		BoxLayout:
			id: boxlayout_statusbar
			size_hint_y: None
			height: "43dp" # enables two lines display for fiat computation formula
			canvas.before:
				Color:
					rgb: [0,0,0]
				Rectangle:
					pos: self.pos
					size: self.size

			GridLayout:
				id: gridlayout_status_bar
				cols: 2
				ScrollView:
					id: scrlv_status_bar
					do_scroll_y: False # limiting to horizontal scrolling
					effect_cls: ScrollEffect #prevents overscrolling
					Label:
						id: status_bar
						size_hint_y: None
						height: self.texture_size[1]
						text_size: (self.width-20), None
						# max_lines: 1000 no effect !
						line_height: 0.9
						background_color: 0,0,0,0
						foreground_color: 1,1,1,1
						valign: "top"
						markup: True
				Button:
					id: clear_output_Button
					text: 'Clear'
					size_hint_x: None
					width: dp(130)
					disabled: True
					on_press: root.clearOutput()

<SelectableMultiFieldsItem>:
	cols: 2
	rows: 1
	text: ''

	# add selection background
	canvas.before:
		Color:
			rgba: (1, 0, 0, 1) if self.selected else (.0, 0.9, .1, .3)
		Rectangle:
			pos: self.pos
			size: self.size

	Label:
		size_hint_x: 0.9
		text: root.text
		markup: True
	CheckBox:
		id: download_chkbox
		size_hint_x: 0.1
		active: False
		on_press: root.toggleCheckbox(self, self.active)

<ScrollableLabelPopup>: # sub-class of AbstractPopup, which derives from Popup
	id: scr_popup
	auto_dismiss: False
	contentBox: content_box
	scrollView: scroll_view
	nextPageButton: next_page_button
	prevPageButton: prev_page_button

	BoxLayout:
		id: content_box
		orientation: "vertical"
		content: content_text

		ScrollView:
			id: scroll_view
			effect_cls: "ScrollEffect" # prevents overscrolling
			do_scroll_x: False # limiting to vertical scrolling
			Label:
				id: content_text
				size_hint_y: None
				height: self.texture_size[1]
				text_size: (self.width-20), None
				line_height: 0.9
				valign: "top"
				markup: True

		BoxLayout:
			orientation: 'horizontal'
			size_hint_y: None
			height: '28dp'
			Button:
				text: "Close"
				on_press: root.dismiss()
			Button:
				id: prev_page_button
				text: "Previous page"
				on_press: scr_popup.previousPage()
			Button:
				id: next_page_button
				text: "Next page"
				on_press: scr_popup.nextPage()
